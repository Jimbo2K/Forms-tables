function chequeaBotones(){var a=Boolean($(".seleccionado")[0]);0!==libreria.length&&a?($("#modificar").removeClass("disabled"),$("#quitar").removeClass("disabled"),$("#anadir").addClass("disabled"),$("#buscar").addClass("disabled")):($("#modificar").addClass("disabled"),$("#quitar").addClass("disabled"),$("#anadir").removeClass("disabled"),$("#buscar").removeClass("disabled"))}function pintarLinea(a,i){$("#tableta").append('<tr class="linea" onclick="seleccionar(this);"><td>'+a.isbn+"</td><td>"+a.titulo+"</td><td>"+a.autor+"</td><td>"+a.anio+"</td><td>"+a.editorial+'</td><td class="oculto">'+i+"</td></tr>")}function actualizar(a){if(0!==a.length){var i;if($(".linea").remove(),$("#busqueda").text(""),$("#resultado").text(""),$("th").css("background-color","#B4C9CC"),a===libreria)for(i in a)pintarLinea(a[i],i);else{for(i in a)pintarLinea(a[i],a[i].indice);$("th").css("background-color","#66ffb3"),$("#busqueda").text("Resultados de la búsqueda")}limpiaForm()}else $(".linea").remove();chequeaBotones()}function calculaIsbn10(a){var i,o,r=0;for(o=a.toLowerCase(),i=0;i<o.length-1;i++)r+=Number(o[i])*(i+1);return r%=11,10==r&&(r="x"),r==o[o.length-1]?!0:!1}function calculaIsbn13(a){var i,o=0;for(i=1;12>=i;i+=2)o=o+3*Number(a[i])+Number(a[i-1]);return o=10-o%10,o==Number(a[a.length-1])?!0:!1}function contarNumeros(a){var i,o=a.length;return 10===o?i=calculaIsbn10(a):13===o&&(i=calculaIsbn13(a)),i}function compararisbn(a){for(var i=libreria.length,o=0,r=0;i>r;r++)if(libreria[r].isbn.toLowerCase()==a.toLowerCase()){o=1,console.log("coincidencia");break}return 1==o?($("#isbnnull").html("Ya existe una entrada con este ISBN"),salida=!1,$("#isbn").css("border","1px solid red"),!1):!0}function validarIsbn(){var a,i="",o=/^\s*(?:\d{9}[0-9xX]{1}|\d{13})\s*?/g,r=$("#isbn").val().trim();return o.test(r)?(r.toLowerCase(),contarNumeros(r)?($("#isbn").css("border","1px solid black"),a=!0):(i="ISBN inválido, nro. de control incorrecto",$("#isbn").css("border","2px solid red"),a=!1)):($("#isbn").css("border","2px solid red"),i="Formato de ISBN inválido 10/13 dígitos",$("#isbn").css("border","2px solid red"),a=!1),$("#isbnnull").html(i),a}function validarTitulo(){var a=/\w+/,i=$("#titulo").val().trim();return a.test(i)?($("#titulo").css("border","1px solid black"),$("#titulonull").html(""),!0):($("#titulo").css("border","2px solid red"),$("#titulonull").html(" Título incorrecto"),!1)}function validarAutor(){var a=$("#autor").val().trim();return""!==a?($("#autor").css("border","1px solid black"),$("#autornull").html(""),!0):($("#autor").css("border","2px solid #a8410f"),$("#autornull").html(" Autor vacío"),!1)}function validarAnio(){var a=/\d{1,4}/,i=$("#anio").val().trim();return a.test(i)?($("#anio").css("border","1px solid black"),$("#anionull").html(""),!0):($("#anio").css("border","2px solid #a8410f"),$("#anionull").html(" Año publ. incorrecto: 4 dígitos"),!1)}function validarEditorial(){var a=$("#editorial").val().trim();return""!==a?($("#editorial").css("border","1px solid black"),$("#editorialnull").html(""),!0):($("#editorial").css("border","2px solid #a8410f"),$("#editorialnull").html(" Editorial vacía"),!1)}function validar(){var a,i,o,r,e,l={};return void 0===$("#oculto").val()?l.indice=libreria.length:l.indice=$("#oculto").val(),a=validarIsbn(),l.isbn=a?$("#isbn").val():"",i=validarTitulo(),l.titulo=i?$("#titulo").val():"",o=validarAutor(),l.autor=o?$("#autor").val():"",r=validarAnio(),l.anio=r?$("#anio").val():"",e=validarEditorial(),l.editorial=e?$("#editorial").val():"",a&&i?o&&r&&e?l:confirm("Hay datos incorrectos, ¿desea continuar?")?l:null:null}function limpiaForm(){$("input").val(""),$("input").css("border","1px solid black"),$(".mensaje").html("")}function objFormulario(){var a={};return void 0===$("#oculto").val()?a.indice=libreria.length:a.indice=Number($("#oculto").val()),a.isbn=$("#isbn").val(),a.titulo=$("#titulo").val(),a.autor=$("#autor").val(),a.anio=$("#anio").val(),a.editorial=$("#editorial").val(),a}function formNoVacio(){var a=$("#isbn").val()+$("#titulo").val()+$("#autor").val()+$("#anio").val()+$("#editorial").val();return console.log("cadena: "+a),""===a?!1:!0}function comparaObj(a,i){var o,r,e=0;for(r in a){if(console.log("form: "+a[r]+" libreria: "+i[r]),e>=6)break;if(a[r]!==i[r]){o=!1;break}o=!0,e++}return o}function seleccionar(a){var i;if(-1!==a.getAttribute("class").indexOf("seleccionado"))$(a).removeClass("seleccionado"),limpiaForm();else{var o=objFormulario();if(console.log("Comparacion "+comparaObj(o,libreria[o.indice])),i=!comparaObj(o,libreria[o.indice])&&formNoVacio()?confirm("Si realiza una nueva selección perderá los cambios \n ¿Desea continuar?"):!0){$("tr").removeClass("seleccionado"),$(a).addClass("seleccionado");var r,e=[];for(r=1;6>=r;r++)e.push($(".seleccionado :nth-of-type("+r+")").text());$("#isbn").val(e[0]),$("#titulo").val(e[1]),$("#autor").val(e[2]),$("#anio").val(e[3]),$("#editorial").val(e[4]),$("#oculto").val(e[5])}}chequeaBotones()}function alta(){$("#oculto").val(libreria.length);var a=validar(),i=compararisbn($("#isbn").val());a&&i?(librosactuales=libreria.length,libreria[librosactuales]=a,actualizar(libreria)):alert("Los datos introducidos no son válidos")}function modificar(){nuevodato=validar(),nuevodato?(libroactual=nuevodato.indice,console.log("indice cargado: "+nuevodato.indice),libreria[libroactual]=nuevodato,actualizar(libreria)):alert("Los datos introducidos no son válidos"),chequeaBotones()}function borrar(){if(confirm("¿Desea borrar esta entrada?")){var a=$("#oculto").val();libreria.splice(a,1),actualizar(libreria)}}function busqueda(){busquedas=[],busquedasaux=[];var a;$("#resultado").text("");var i=!1;$("#isbn").val()&&(busquedasactuales=busquedas.length,0===busquedasactuales&&i===!1?(a=$("#isbn").val(),abuscar("isbn",a)):busquedasactuales>0&&abuscarb("isbn",a)),$("#titulo").val()&&(busquedasactuales=busquedas.length,0===busquedasactuales&&i===!1?(a=$("#titulo").val(),abuscar("titulo",a)):busquedasactuales>0&&(a=$("#titulo").val(),abuscarb("titulo",a))),$("#autor").val()&&(busquedasactuales=busquedas.length,0===busquedasactuales&&i===!1?(a=$("#autor").val(),abuscar("autor",a)):busquedasactuales>0&&(a=$("#autor").val(),abuscarb("autor",a))),$("#anio").val()&&(busquedasactuales=busquedas.length,0===busquedasactuales&&i===!1?(a=$("#anio").val(),abuscar("anio",a)):busquedasactuales>0&&(a=$("#anio").val(),abuscarb("anio",a))),$("#editorial").val()&&(busquedasactuales=busquedas.length,0===busquedasactuales&&i===!1?(a=$("#editorial").val(),abuscar("editorial",a)):busquedasactuales>0&&(a=$("#editorial").val(),abuscarb("editorial",a))),actualizar(busquedas)}function abuscar(a,o){for(librosactuales=libreria.length,i=0;i<librosactuales;i++)-1!=libreria[i][a].indexOf(o)&&busquedas.push(libreria[i]);0===busquedas.length&&(sinencontrar=!0,$("#resultado").text("No encontramos libros que coincidan con los valores introducidos"),$("#busqueda").text("Resultados de la búsqueda"),$("th").css("background-color","#66ffb3"))}function abuscarb(a,i){busquedasaux=[],busquedasactuales=busquedas.length;for(var o=0;o<busquedasactuales;o++)-1!=busquedas[o][a].indexOf(i)&&busquedasaux.push(busquedas[o]);busquedas=JSON.parse(JSON.stringify(busquedasaux)),0===busquedas.length&&($("#resultado").text("No encontramos libros que coincidan con los valores introducidos"),$("#busqueda").text("Resultados de la búsqueda"),$("th").css("background-color","#66ffb3"))}function probartabla(){var a={isbn:"6969696969",titulo:"jquery mola",autor:"unas",anio:"1979",editorial:"veces o más"},i='<tr class="linea" onclick="seleccionar(this);"><td>'+a.isbn+"</td><td>"+a.titulo+"</td><td>"+a.autor+"</td><td>"+a.anio+"</td><td>"+a.editorial+'</td><td class="oculto">'+a.indice+"</td></tr>";$("#tableta").append(i)}function numeroAzar(){var a=Math.round(10*Math.random());return 10===a&&(a=9),a}function libro(a,i,o,r,e,l){this.indice=a,this.isbn=i,this.titulo=o,this.autor=r,this.anio=e,this.editorial=l}function arrayAleatorio(){var a,i=["123456789X","1234567890128","1111111111116","1212121212128","1452367892","9999999999","4561597530","951357654x","258456159x","7531598523"],o=["JQuery y tú","El linter, tu gran amigo","100 razones para odiar IE","Oda al pantallazo azul","El Señor de los gramillos","Mucho ruido y pocos altramuces","LSD y programación","10 pasos para desengancharte del código","Guerra y Paz III","Cumbres con nubes y claros"],r=["Guillermo Puertas","Java El Hutt","León Tostón","Alan Turning","Adrián Arteaga","Juan José Basco","Pablo Andueza","Pablo Garrido","Rubén Álvarez","Chespirito"],e=["1234","5678","9123","2016","1975","1981","1732","2222","1997","2010"],l=["Satelite","Bruguerra","Chonibooks","Mocosoft","Ran-Ma","Livros pa' que","Editorial","Exoplaneta","Macgrou Jill","Salbamé Delujs"];for(a=0;10>a;a++)libreriaaux[a].indice=a,libreriaaux[a].isbn=i[a],libreriaaux[a].titulo=o[numeroAzar()],libreriaaux[a].autor=r[numeroAzar()],libreriaaux[a].anio=e[numeroAzar()],libreriaaux[a].editorial=l[numeroAzar()];libreria=libreriaaux,actualizar(libreria)}var libreria=[],busquedas=[],busquedasaux=[];$(function(){chequeaBotones(),$("#isbn").bind("input change",validarIsbn),$("#titulo").bind("input change",validarTitulo),$("#autor").bind("input change",validarAutor),$("#anio").bind("input change",validarAnio),$("#editorial").bind("input change",validarEditorial),$("#anadir").click(function(){Boolean($(".seleccionado")[0])||alta()}),$("#buscar").click(function(){if(!Boolean($(".seleccionado")[0]))switch($("#buscar").text()){case"BUSCAR":formNoVacio()&&($("#buscar").text("VOLVER"),busqueda());break;case"VOLVER":$("#buscar").text("BUSCAR"),actualizar(libreria)}}),$("#modificar").click(function(){Boolean($(".seleccionado")[0])&&modificar()}),$("#quitar").click(function(){Boolean($(".seleccionado")[0])&&borrar()})});var libreriaaux=[new libro,new libro,new libro,new libro,new libro,new libro,new libro,new libro,new libro,new libro];