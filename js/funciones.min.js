function chequeaBotones(){var a=Boolean($(".seleccionado")[0]);0!==libreria.length&&a?($("#modificar").removeClass("disabled"),$("#quitar").removeClass("disabled"),$("#anadir").addClass("disabled")):($("#modificar").addClass("disabled"),$("#quitar").addClass("disabled"),$("#anadir").removeClass("disabled"))}function pintarLinea(a){$("#tableta").append('<tr class="linea" onclick="seleccionar(this);"><td>'+a.isbn+"</td><td>"+a.titulo+"</td><td>"+a.autor+"</td><td>"+a.anio+"</td><td>"+a.editorial+'</td><td class="oculto">'+a.indice+"</td></tr>")}function actualizar(){if(0!==libreria.length){var a;$(".linea").remove();for(a in libreria)pintarLinea(libreria[a]);limpiaForm()}else $(".linea").remove();chequeaBotones()}function calculaIsbn10(a){var i,o,r=0;for(o=a.toLowerCase(),i=0;i<o.length-1;i++)r+=Number(o[i])*(i+1);return r%=11,10==r&&(r="x"),r==o[o.length-1]?!0:!1}function calculaIsbn13(a){var i,o=0;for(i=1;12>=i;i+=2)o=o+3*Number(a[i])+Number(a[i-1]);return o=10-o%10,o==Number(a[a.length-1])?!0:!1}function contarNumeros(a){var i,o=a.length;return 10===o?i=calculaIsbn10(a):13===o&&(i=calculaIsbn13(a)),i}function compararisbn(a){for(var i=libreria.length,o=0,r=0;i>r;r++)if(libreria[r].isbn==a){o=1;break}return 1==o?($("#isbnnull").html("Ya existe una entrada con este ISBN"),salida=!1,$("#isbn").css("border","1px solid red"),!1):!0}function validarIsbn(){var a,i="",o=/^\s*(?:\d{9}[0-9xX]{1}|\d{13})\s*?/g,r=$("#isbn").val().trim();return o.test(r)?(r.toLowerCase(),contarNumeros(r)?($("#isbn").css("border","1px solid black"),a=!0):(i="ISBN inválido, nro. de control incorrecto",$("#isbn").css("border","1px solid red"),a=!1)):($("#isbn").css("border","1px solid red"),i="Formato de ISBN inválido 10/13 dígitos",$("#isbn").css("border","1px solid red"),a=!1),$("#isbnnull").html(i),a}function validarTitulo(){var a=/\w+/,i=$("#titulo").val().trim();return a.test(i)?($("#titulo").css("border","1px solid black"),$("#titulonull").html(""),!0):($("#titulo").css("border","1px solid red"),$("#titulonull").html(" Título incorrecto"),!1)}function validarAutor(){var a=$("#autor").val().trim();return""!==a?($("#autor").css("border","1px solid black"),$("#autornull").html(""),!0):($("#autor").css("border","1px solid orange"),$("#autornull").html(" Autor vacío"),!1)}function validarAnio(){var a=/\d{1,4}/,i=$("#anio").val().trim();return a.test(i)?($("#anio").css("border","1px solid black"),$("#anionull").html(""),!0):($("#anio").css("border","1px solid orange"),$("#anionull").html(" Año publ. incorrecto: 4 dígitos"),!1)}function validarEditorial(){var a=$("#editorial").val().trim();return""!==a?($("#editorial").css("border","1px solid black"),$("#editorialnull").html(""),!0):($("#editorial").css("border","1px solid orange"),$("#editorialnull").html(" Editorial vacía"),!1)}function validar(){var a,i,o,r,l,n={};return void 0===$("#oculto").val()?n.indice=libreria.length:n.indice=$("#oculto").val(),a=validarIsbn(),n.isbn=a?$("#isbn").val():"",i=validarTitulo(),n.titulo=i?$("#titulo").val():"",o=validarAutor(),n.autor=o?$("#autor").val():"",r=validarAnio(),n.anio=r?$("#anio").val():"",l=validarEditorial(),n.editorial=l?$("#editorial").val():"",a&&i?o&&r&&l?n:confirm("Hay datos incorrectos, ¿desea continuar?")?n:null:null}function limpiaForm(){$("input").val(""),$("input").css("border","1px solid black"),$("span").html("")}function objFormulario(){var a={};return void 0===$("#oculto").val()?a.indice=libreria.length:a.indice=$("#oculto").val(),a.isbn=$("#isbn").val(),a.titulo=$("#titulo").val(),a.autor=$("#autor").val(),a.anio=$("#anio").val(),a.editorial=$("#editorial").val(),a}function formNoVacio(){var a=$("#isbn").val()+$("#titulo").val()+$("#autor").val()+$("#anio").val()+$("#editorial").val();return console.log("cadena: "+a),""===a?!1:!0}function seleccionar(a){var i;if(-1!==a.getAttribute("class").indexOf("seleccionado"))$(a).removeClass("seleccionado"),limpiaForm();else{var o=objFormulario();if(i=o!==libreria[o.indice]&&formNoVacio()?confirm("Si realiza una nueva selección perderá los cambios \n ¿Desea continuar?"):!0){$("tr").removeClass("seleccionado"),$(a).addClass("seleccionado");var r,l=[];for(r=1;6>=r;r++)l.push($(".seleccionado :nth-of-type("+r+")").text());$("#isbn").val(l[0]),$("#titulo").val(l[1]),$("#autor").val(l[2]),$("#anio").val(l[3]),$("#editorial").val(l[4]),$("#oculto").val(l[5])}}chequeaBotones()}function alta(){$("#oculto").val(libreria.length);var a=validar(),i=compararisbn($("#isbn").val());a&&i?(librosactuales=libreria.length,libreria[librosactuales]=a,actualizar()):alert("Los datos introducidos no son válidos")}function modificar(){nuevodato=validar(),nuevodato?(libroactual=nuevodato.indice,console.log("indice cargado: "+nuevodato.indice),libreria[libroactual]=nuevodato,actualizar()):alert("Los datos introducidos no son válidos"),chequeaBotones()}function borrar(){var a=$("#oculto").val();libreria.splice(a,1),actualizar()}function probartabla(){var a={isbn:"6969696969",titulo:"jquery mola",autor:"unas",anio:"1979",editorial:"veces o más"},i='<tr class="linea" onclick="seleccionar(this);"><td>'+a.isbn+"</td><td>"+a.titulo+"</td><td>"+a.autor+"</td><td>"+a.anio+"</td><td>"+a.editorial+'</td><td class="oculto">'+a.indice+"</td></tr>";$("#tableta").append(i)}function numeroAzar(){var a=Math.round(10*Math.random());return 10===a&&(a=9),a}function libro(a,i,o,r,l,n){this.indice=a,this.isbn=i,this.titulo=o,this.autor=r,this.anio=l,this.editorial=n}function arrayAleatorio(){var a,i=["123456789X","1234567890128","1111111111116","1212121212128","1452367892","9999999999","4561597530","951357654x","258456159x","7531598523"],o=["JQuery y tú","El linter, tu gran amigo","100 razones para odiar IE","Oda al pantallazo azul","El Señor de los gramillos","Mucho ruido y pocos altramuces","LSD y programación","10 pasos para desengancharte del código","Guerra y Paz III","Cumbres con nubes y claros"],r=["Guillermo Puertas","Java El Hutt","León Tostón","Alan Turning","Adrián Arteaga","Juan José Basco","Pablo Andueza","Pablo Garrido","Rubén Álvarez","Chespirito"],l=["1234","5678","9123","2016","1975","1981","1732","2222","1997","2010"],n=["Satelite","Bruguerra","Chonibooks","Mocosoft","Ran-Ma","Livros pa' que","Editorial","Exoplaneta","Macgrou Jill","Salbamé Delujs"];for(a=0;10>a;a++)libreriaaux[a].indice=a,libreriaaux[a].isbn=i[a],libreriaaux[a].titulo=o[numeroAzar()],libreriaaux[a].autor=r[numeroAzar()],libreriaaux[a].anio=l[numeroAzar()],libreriaaux[a].editorial=n[numeroAzar()];libreria=libreriaaux,actualizar()}var libreria=[];$(function(){chequeaBotones(),$("#isbn").bind("input change",validarIsbn),$("#titulo").bind("input change",validarTitulo),$("#autor").bind("input change",validarAutor),$("#anio").bind("input change",validarAnio),$("#editorial").bind("input change",validarEditorial),$("#anadir").click(function(){Boolean($(".seleccionado")[0])||alta()}),$("#modificar").click(function(){Boolean($(".seleccionado")[0])&&modificar()}),$("#quitar").click(function(){Boolean($(".seleccionado")[0])&&borrar()})});var libreriaaux=[new libro,new libro,new libro,new libro,new libro,new libro,new libro,new libro,new libro,new libro];